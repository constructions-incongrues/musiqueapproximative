# Configuration des desastres - Musique Approximative
#
# Ce fichier definit les regles et les recettes pour le systeme de desastres.
# Les regles permettent de determiner quand un desastre doit etre applique,
# et les recettes definissent quels assets (CSS/JS) charger.

regles:
  # Desastre "bleu" sur le titre ou l'artiste
  - query: "query.title ~ /.*bleu.*/i || query.artist ~ /.*bleu.*/i"
    recettes: [bleu]
    probability: 0.7

  # Desastre "amour" : declanche si le titre contient "amour" ou "love"
  - query: "query.title ~ /.*(amour|love).*/i"
    recettes: [amour]
    probability: 0.7
    scripts:
      - https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js

  # Desastre "robot"
  - query: "query.title ~ /.*robot.*/i"
    recettes: [robot]
    probability: 0.7

  # Desastre "fish" : declanche si le titre contient "fish" ou "poisson"
  - query: "query.title ~ /.*(fish|poisson).*/i"
    recettes: [fish]
    probability: 0.7

  # Desastre "noir" : declanche si le titre contient "noir" ou "black"
  - query: "query.title ~ /.*(noir|black).*/i"
    recettes: [noir]
    probability: 0.7
    scripts:
      - https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js

  # Desastre "light" : declanche si le titre contient "light" ou "lumiere"
  - query: "query.title ~ /.*(light|lumiere).*/i"
    recettes: [light]
    probability: 0.7
    scripts:
      - https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js

  # Desastre "mort" : declanche si le titre contient "mort", "morte", "morts", "death", "deaths" ou "dead"
  - query: "query.title ~ /.*(morte?s?|deaths?|dead).*/i"
    recettes: [mort]
    probability: 0.7

  # Désastre téléphonique : déclenche si le titre contient "phone" ou "téléphone" ou allo
  - query: "query.title ~ /.*(phone|t[eé]l[eé]phone|allo).*/i"
    recettes: [mamie]
    probability: 0.5

  # Desastre "musique" : declanche si le titre contient "musique" ou "music"
  - query: "query.title ~ /.*(musique|music).*/i"
    recettes: [musique]
    probability: 0.7

  # Desastre "spooky" : WHO U GONNA CALL ?
  - query: "query.title == 'Spooky Mix'"
    recettes: [spooky]
    probability: 1.0

  # Desastres "quickos" : LALALOS !
  - query: "context.date.month == '12'"
    recettes: [quickos]
    probability: 0.1
  - query: "context.date.month == '12' && (context.date.day == '24' || context.date.day == '25')"
    recettes: [quickos]
    probability: 0.5

  # Desastres "tts"
  - query: "query.title ~ /.*(TTS).*/"
    recettes: [tts_rapper]
    probability: 1.0
  - query: "query.title ~ /(.*)/"
  #- query: "context.date.minute == 0 || context.date.minute == 15 || context.date.minute == 30 || context.date.minute == 45"
    recettes: [tts_jinglist]
    probability: 1.0

  # Désastre "danse"
  - query: "query.title ~ /.*(danse).*/i"
    recettes: [danse]
    probability: 1.0

  # Désastre "splitouine"
  - query: "query.artist ~ /.*(catani).*/i"
    recettes: [splitouine_titles_matchduration]
    probability: 1.0

  # Désastres "mangelettres"
  - query: "query.title ~ /(.*)/i"
    recettes: [consonnard, voyelliste]
    probability: 0.05

  # Désastre "kraftwerk"
  - query: "query.artist ~ /.*(kraftwerk).*/i"
    recettes: [kraftwerk]
    probability: 1.0

  # Désastre "sale"
  - query: "query.artist ~ /.*(sale).*/i"
    recettes: [sale]
    probability: 1.0

  # Les options sont accessibles via :
  # - JavaScript: window.DesastreOptions.<recette>.<option>
  # - CSS: var(--desastre-<recette>-<option>)
recettes:
  # Recette "bleu"
  bleu:
    enabled: true
    desastre: bleu

  # Recette "amour"
  amour:
    enabled: true
    desastre: amour

  # Recette "robot"
  robot:
    enabled: true
    desastre: robot

  # Recette "fish"
  fish:
    enabled: true
    desastre: fish

  # Recette "noir"
  noir:
    enabled: true
    desastre: noir

  # Recette "light"
  light:
    enabled: true
    desastre: light

  # Recette "mort"
  mort:
    enabled: true
    desastre: mort
    options:
      imageFolder: /desastres/mort/img
      imageBaseName: cimetiere
      imageExtension: png
      imageCount: 20
      tombSize: 120
      delay: 800

  # Recette "mamie"
  mamie:
    enabled: true
    desastre: mamie
    options:
      volume: 0.5

  # Recette "musique"
  musique:
    enabled: true
    desastre: musique
    scripts:
      - https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js

  # Recette "spooky" spécialement pour les chouchouxes
  spooky:
    enabled: true
    desastre: redirect
    options:
      url: https://sos.musiqueapproximative.net
      seconds: 3

  # Recette "quickos" pour les fêtes
  quickos:
    enabled: true
    desastre: redirect
    options:
      url: https://quickoschantenoel.musiqueapproximative.net/?play=1
      seconds: 3

  # Recettes "tts"
  tts_rapper:
    enabled: true
    desastre: tts
    options:
      selector: div.descriptif p
  tts_jinglist:
    enabled: true
    desastre: tts
    options:
      texts:
        - Vous êtes sur Musique Approximative
        - Il fait beau n'est-ce pas ?

  # Recette "danse"
  danse:
    enabled: true
    desastre: danse

  splitouine_titles_matchduration:
    enabled: true
    scripts:
      - https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js
      - https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/SplitText.min.js
    desastre: splitouine
    options:
      split:
        selector: p.title, h1, h2
        configuration:
          type: words, lines, chars
          mask: lines
          autoSplit: false
          wordDelimiter: " "
          wordsClass: word
      tween:
        type: chars
        audio:
          id: 'jp_audio_0'
          matchDuration: true
        configuration:
          y: 100
          rotation: 90
          opacity: 0
          ease: elastic

  # Recette "radioactivite"
  kraftwerk:
    enabled: true
    desastre: kraftwerk
    options:
      imageFolder: /desastres/kraftwerk/img
      imageBaseName: kraftwerk
      imageExtension: svg
      imageCount: 1
      delay: 800

  # Recette "sale"
  sale:
    enabled: true
    desastre: sale
    options:
      imageFolder: /desastres/sale/img
      imageBaseName: sale
      imageExtension: svg
      imageCount: 1
      delay: 800

  # Mange-Lettres
  # L'infâme Consonnard
  consonnard:
    enabled: true
    desastre: mangelettres
    scripts:
      - /desastres/shared/desastre-audio.js
      - https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js
      - https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/SplitText.min.js
    options:
      selector: .title
      rate: 0.7
      target: aeiouy
      case: insensitive

  # Le Voyelliste sournois
  voyelliste:
    enabled: true
    desastre: mangelettres
    scripts:
      - /desastres/shared/desastre-audio.js
      - https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js
      - https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/SplitText.min.js
    options:
      selector: .title
      rate: 0.7
      target: bcdfghjklmnpqrstvwxz
      case: insensitive

