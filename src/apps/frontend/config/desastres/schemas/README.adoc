= Sch√©mas JSON pour la validation des d√©sastres

Ce dossier contient les sch√©mas JSON Schema pour valider les fichiers de configuration des d√©sastres.

== Fichiers

=== 1. `desastres-main.schema.json`

Sch√©ma pour le fichier principal `desastres.yml` avec imports.

*Usage* : Ajoutez en haut de `desastres.yml` :

[,yaml]
----
# yaml-language-server: $schema=./desastres/schemas/desastres-main.schema.json
----

=== 2. `regles.schema.json`

Sch√©ma pour les fichiers de r√®gles (`desastres/regles/*.yml`).

*Usage* : Ajoutez en haut de chaque fichier de r√®gles :

[,yaml]
----
# yaml-language-server: $schema=../schemas/regles.schema.json
----

=== 3. `recettes.schema.json`

Sch√©ma pour les fichiers de recettes (`desastres/recettes/*.yml`).

*Usage* : Ajoutez en haut de chaque fichier de recettes :

[,yaml]
----
# yaml-language-server: $schema=../schemas/recettes.schema.json
----

== Avantages

‚úÖ *Autocompl√©tion* dans VSCode, IntelliJ, etc.
‚úÖ *Validation* en temps r√©el
‚úÖ *Documentation* int√©gr√©e (descriptions, exemples)
‚úÖ *Pr√©vention d'erreurs* (types, propri√©t√©s requises, etc.)

== Installation dans VSCode

. Installer l'extension *YAML* (Red Hat)
. Ajouter la directive `# yaml-language-server` en haut des fichiers
. Profiter de l'autocompl√©tion et de la validation ! üéâ

== Exemples de validation

=== ‚úÖ R√®gle valide

[,yaml]
----
regles:
  - query: "query.title ~ /.*bleu.*/i"
    recettes: [bleu]
    probability: 0.7
    trigger: debug_bleu
----

=== ‚ùå R√®gle invalide

[,yaml]
----
regles:
  - query: "query.title ~ /.*bleu.*/i"
    # ‚ùå Erreur: propri√©t√© 'recettes' manquante (requise)
    probability: 0.7
----

=== ‚úÖ Recette valide (TTS avec plages)

[,yaml]
----
recettes:
  tts_jinglist:
    enabled: true
    desastre: tts
    options:
      rate: [0.5, 1.5]     # ‚úÖ Plage valide
      pitch: [0.8, 1.2]    # ‚úÖ Plage valide
      volume: 0.7          # ‚úÖ Nombre fixe valide
----

=== ‚ùå Recette invalide

[,yaml]
----
recettes:
  tts_jinglist:
    enabled: true
    desastre: tts
    options:
      rate: [0.5, 15.0]    # ‚ùå Erreur: 15.0 > maximum (10)
      pitch: 3.0           # ‚ùå Erreur: 3.0 > maximum (2)
----

== Structure des sch√©mas

=== R√®gles (`regles.schema.json`)

*Propri√©t√©s* :

* `query` (string, requis) : Expression de condition
* `recettes` (array, requis) : Liste des recettes √† appliquer
* `probability` (number, 0-1) : Probabilit√© d'application
* `trigger` (string) : Param√®tre URL pour forcer le d√©clenchement
* `scripts` (array, deprecated) : ‚ö†Ô∏è √Ä d√©finir dans les recettes

=== Recettes (`recettes.schema.json`)

*Propri√©t√©s* :

* `enabled` (boolean, requis) : Active/d√©sactive la recette
* `desastre` (string, requis) : Type de d√©sastre
* `scripts` (array) : Scripts JavaScript √† charger
* `options` (object) : Options sp√©cifiques au d√©sastre
 ** `selector` : S√©lecteur CSS
 ** `url` : URL pour d√©sastres dynamiques
 ** `rate`, `pitch`, `volume` : Param√®tres TTS (nombre ou [min, max])
 ** `lang` : Code langue (ex: "fr-FR")
 ** `voices` : Liste de noms de voix
 ** `imageFolder`, `imageBaseName`, `imageExtension`, `imageCount` : Images
 ** Et bien d'autres...

== Validation en ligne de commande

Vous pouvez valider les fichiers avec un outil comme `ajv-cli` :

[,bash]
----
npm install -g ajv-cli

# Valider un fichier de r√®gles
ajv validate -s schemas/regles.schema.json -d regles/colors.yml

# Valider un fichier de recettes
ajv validate -s schemas/recettes.schema.json -d recettes/tts.yml
----

== Contribution

Pour ajouter de nouvelles propri√©t√©s aux sch√©mas :

. √âditez le fichier `.schema.json` appropri√©
. Ajoutez la propri√©t√© dans `properties`
. Documentez avec `description` et `examples`
. Testez la validation dans votre √©diteur

== Documentation JSON Schema

* https://json-schema.org/understanding-json-schema/[JSON Schema Documentation]
* https://github.com/redhat-developer/yaml-language-server[YAML Language Server]

'''

*Cr√©√© avec ‚ù§Ô∏è pour Musique Approximative*
